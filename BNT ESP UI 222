local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

local ESP_Boxes = {}

-- Função para criar linhas de canto
local function CreateCornerLines()
    local lines = {}
    for i = 1, 8 do
        local line = Drawing.new("Line")
        line.Visible = false
        line.Color = Color3.fromRGB(255, 0, 0) -- Vermelho
        line.Thickness = 2
        table.insert(lines, line)
    end
    return lines
end

-- Função para criar o ESP para um jogador
local function CreateESP(Player)
    if not ESP_Boxes[Player] then
        ESP_Boxes[Player] = CreateCornerLines()
    end
end

-- Função para remover o ESP de um jogador
local function RemoveESP(Player)
    if ESP_Boxes[Player] then
        for _, line in pairs(ESP_Boxes[Player]) do
            line:Remove()
        end
        ESP_Boxes[Player] = nil
    end
end

-- Função para atualizar o ESP
local function UpdateESP()
    for _, Player in pairs(Players:GetPlayers()) do
        if Player ~= LocalPlayer and Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
            local RootPart = Player.Character.HumanoidRootPart
            local RootPosition, onScreen = Camera:WorldToViewportPoint(RootPart.Position)

            if onScreen then
                local HeadPosition = Camera:WorldToViewportPoint(RootPart.Position + Vector3.new(0, 3, 0))
                local LegPosition = Camera:WorldToViewportPoint(RootPart.Position - Vector3.new(0, 3, 0))

                local boxHeight = HeadPosition.Y - LegPosition.Y
                local boxWidth = boxHeight / 2
                local boxSize = Vector2.new(boxWidth, boxHeight)
                local boxPosition = Vector2.new(RootPosition.X - boxWidth / 2, RootPosition.Y - boxHeight / 2)

                local lines = ESP_Boxes[Player]
                if lines then
                    -- Tamanho do canto
                    local cornerSize = boxWidth * 0.2

                    -- Linhas superiores
                    lines[1].From = Vector2.new(boxPosition.X, boxPosition.Y + cornerSize)
                    lines[1].To = Vector2.new(boxPosition.X, boxPosition.Y)
                    lines[1].Visible = true

                    lines[2].From = Vector2.new(boxPosition.X, boxPosition.Y)
                    lines[2].To = Vector2.new(boxPosition.X + cornerSize, boxPosition.Y)
                    lines[2].Visible = true

                    lines[3].From = Vector2.new(boxPosition.X + boxWidth - cornerSize, boxPosition.Y)
                    lines[3].To = Vector2.new(boxPosition.X + boxWidth, boxPosition.Y)
                    lines[3].Visible = true

                    lines[4].From = Vector2.new(boxPosition.X + boxWidth, boxPosition.Y)
                    lines[4].To = Vector2.new(boxPosition.X + boxWidth, boxPosition.Y + cornerSize)
                    lines[4].Visible = true

                    -- Linhas inferiores
                    lines[5].From = Vector2.new(boxPosition.X, boxPosition.Y + boxHeight - cornerSize)
                    lines[5].To = Vector2.new(boxPosition.X, boxPosition.Y + boxHeight)
                    lines[5].Visible = true

                    lines[6].From = Vector2.new(boxPosition.X, boxPosition.Y + boxHeight)
                    lines[6].To = Vector2.new(boxPosition.X + cornerSize, boxPosition.Y + boxHeight)
                    lines[6].Visible = true

                    lines[7].From = Vector2.new(boxPosition.X + boxWidth - cornerSize, boxPosition.Y + boxHeight)
                    lines[7].To = Vector2.new(boxPosition.X + boxWidth, boxPosition.Y + boxHeight)
                    lines[7].Visible = true

                    lines[8].From = Vector2.new(boxPosition.X + boxWidth, boxPosition.Y + boxHeight)
                    lines[8].To = Vector2.new(boxPosition.X + boxWidth, boxPosition.Y + boxHeight - cornerSize)
                    lines[8].Visible = true
                end
            else
                if ESP_Boxes[Player] then
                    for _, line in pairs(ESP_Boxes[Player]) do
                        line.Visible = false
                    end
                end
            end
        end
    end
end

-- Conectar eventos
Players.PlayerAdded:Connect(CreateESP)
Players.PlayerRemoving:Connect(RemoveESP)
RunService.RenderStepped:Connect(UpdateESP)

-- Criar ESP para jogadores existentes
for _, Player in pairs(Players:GetPlayers()) do
    if Player ~= LocalPlayer then
        CreateESP(Player)
    end
end
