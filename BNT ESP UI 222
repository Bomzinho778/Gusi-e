local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

local ESPBoxes = {}

local function CreateESP(player)
    if player == LocalPlayer then return end -- NÃ£o criar ESP para si mesmo
    
    local Box = Drawing.new("Square")
    Box.Thickness = 2
    Box.Filled = false
    Box.Color = Color3.fromRGB(255, 0, 0) -- Cor vermelha
    Box.Visible = false

    ESPBoxes[player] = Box

    local function Update()
        if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then
            Box.Visible = false
            return
        end

        local rootPart = player.Character.HumanoidRootPart
        local screenPosition, onScreen = Camera:WorldToViewportPoint(rootPart.Position)

        if onScreen then
            local size = Vector2.new(100, 150) -- Tamanho da caixa
            Box.Size = size
            Box.Position = Vector2.new(screenPosition.X - size.X / 2, screenPosition.Y - size.Y / 2)
            Box.Visible = true
        else
            Box.Visible = false
        end
    end

    RunService.RenderStepped:Connect(Update)
end

local function OnPlayerAdded(player)
    player.CharacterAdded:Connect(function()
        wait(0.5) -- Pequeno delay para garantir que a Character carregou
        CreateESP(player)
    end)
end

for _, player in ipairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        OnPlayerAdded(player)
    end
end

Players.PlayerAdded:Connect(OnPlayerAdded)
Players.PlayerRemoving:Connect(function(player)
    if ESPBoxes[player] then
        ESPBoxes[player]:Remove()
        ESPBoxes[player] = nil
    end
end)
