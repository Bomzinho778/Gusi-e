local SilentAimEnabled = false
local WallCheckEnabled = false
local FOV = 75
local FOVVisible = false
local FOVPosition = "Center"
local FOVCircle = Drawing.new("Circle")
local TeamCheckEnabled = false
_G.targetPart = "Head"

FOVCircle.Radius = FOV
FOVCircle.Thickness = 1
FOVCircle.Color = Color3.new(1, 1, 1)
FOVCircle.Transparency = 1
FOVCircle.Visible = FOVVisible
FOVCircle.Filled = false
FOVCircle.Position = Vector2.new(workspace.CurrentCamera.ViewportSize.X / 2, workspace.CurrentCamera.ViewportSize.Y / 2)

local function getFOVPosition()
    local camera = workspace.CurrentCamera
    if FOVPosition == "Center" then
        return Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
    elseif FOVPosition == "Mouse" then
        local mouse = game.Players.LocalPlayer:GetMouse()
        return Vector2.new(mouse.X, mouse.Y)
    end
end

local function isPlayerInFOV(player)
    local mousePos = getFOVPosition()
    if player.Character and player.Character:FindFirstChild(_G.targetPart) then
        local charPart = player.Character:FindFirstChild(_G.targetPart)
        local screenPos = workspace.CurrentCamera:WorldToViewportPoint(charPart.Position)
        local distance = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude

        return distance <= FOV
    end
    return false
end

local function isVisible(target)
    if WallCheckEnabled then
        if not target or not target.Character or not target.Character:FindFirstChild(_G.targetPart) then
            return false
        end

        local camera = workspace.CurrentCamera
        local targetPartPos = target.Character:FindFirstChild(_G.targetPart).Position
        local rayOrigin = camera.CFrame.Position
        local rayDirection = (targetPartPos - rayOrigin).Unit * (targetPartPos - rayOrigin).Magnitude

        local raycastParams = RaycastParams.new()
        raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
        raycastParams.FilterDescendantsInstances = {game.Players.LocalPlayer.Character}

        local raycastResult = workspace:Raycast(rayOrigin, rayDirection, raycastParams)

        if raycastResult and raycastResult.Instance then
            return raycastResult.Instance:IsDescendantOf(target.Character)
        end
    end
    return true
end

local function isInFrontOfCamera(player)
    if player.Character and player.Character:FindFirstChild(_G.targetPart) then
        local camera = workspace.CurrentCamera
        local targetPartPos = player.Character:FindFirstChild(_G.targetPart).Position
        local cameraDirection = camera.CFrame.LookVector
        local directionToPlayer = (targetPartPos - camera.CFrame.Position).Unit

        local dotProduct = cameraDirection:Dot(directionToPlayer)
        return dotProduct > 0
    end
    return false
end

local function getClosestPlayer()
    local closestPlayer = nil
    local players = game.Players:GetPlayers()
    local closestDistance = math.huge
    local mousePos = getFOVPosition()

    for _, player in pairs(players) do
        if player ~= game.Players.LocalPlayer and isVisible(player) then
            if TeamCheckEnabled and player.Team == game.Players.LocalPlayer.Team then
                continue
            end

            if isPlayerInFOV(player) and isInFrontOfCamera(player) then
                local charPart = player.Character:FindFirstChild(_G.targetPart)
                if charPart then
                    local screenPos = workspace.CurrentCamera:WorldToViewportPoint(charPart.Position)
                    local distance = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude

                    if distance < closestDistance then
                        closestDistance = distance
                        closestPlayer = player
                    end
                end
            end
        end
    end

    return closestPlayer
end

local function aimAt(target)
    if target and target.Character and target.Character:FindFirstChild(_G.targetPart) then
        local camera = workspace.CurrentCamera
        local aimPosition = target.Character:FindFirstChild(_G.targetPart).Position
        camera.CFrame = CFrame.new(camera.CFrame.Position, aimPosition)
    end
end

game:GetService("RunService").RenderStepped:Connect(function()
    if SilentAimEnabled then
        local target = getClosestPlayer()
        if target then
            aimAt(target)
        end
    end

    FOVCircle.Position = getFOVPosition()
    FOVCircle.Radius = FOV
    FOVCircle.Visible = FOVVisible
end)

local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()

local Window = OrionLib:MakeWindow({Name = "Title of the library", HidePremium = false, SaveConfig = true, ConfigFolder = "OrionTest"})

local Tab = Window:MakeTab({
    Name = "Tab",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

Tab:AddToggle({
    Name = "Wall Check",
    Default = false,
    Callback = function(Value)
        WallCheckEnabled = Value
        print("Wall Check: ", Value)
    end    
})

Tab:AddToggle({
    Name = "Silent Aim",
    Default = false,
    Callback = function(Value)
        SilentAimEnabled = Value
        print("Silent Aim: ", Value)
    end    
})

Tab:AddToggle({
    Name = "Team Check",
    Default = false,
    Callback = function(Value)
        TeamCheckEnabled = Value
        print("Team Check: ", Value)
    end    
})

Tab:AddColorpicker({
    Name = "FOV Color",
    Default = Color3.fromRGB(255, 0, 0),
    Callback = function(Value)
        FOVCircle.Color = Value
        print("FOV Color: ", Value)
    end   
})

Tab:AddSlider({
    Name = "FOV Thickness",
    Min = 1,
    Max = 10,
    Default = 1,
    Color = Color3.fromRGB(255,255,255),
    Increment = 1,
    ValueName = "Thickness",
    Callback = function(Value)
        FOVCircle.Thickness = Value
        print("FOV Thickness: ", Value)
    end    
})

Tab:AddSlider({
    Name = "FOV Transparency",
    Min = 0,
    Max = 1,
    Default = 1,
    Color = Color3.fromRGB(255,255,255),
    Increment = 0.1,
    ValueName = "Transparency",
    Callback = function(Value)
        FOVCircle.Transparency = Value
        print("FOV Transparency: ", Value)
    end    
})

Tab:AddDropdown({
    Name = "FOV Position",
    Default = "Center",
    Options = {"Center", "Mouse"},
    Callback = function(Value)
        FOVPosition = Value
        print("FOV Position: ", Value)
    end    
})

OrionLib:Init()
