local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

local ESP_Arrows = {}

function CreateArrow(Player)
    if not ESP_Arrows[Player] then
        local Arrow = Instance.new("Frame")
        Arrow.Visible = false
        Arrow.Size = UDim2.new(0, 20, 0, 20) -- Tamanho da seta
        Arrow.BackgroundColor3 = Color3.fromRGB(255, 0, 0) -- Vermelho
        Arrow.AnchorPoint = Vector2.new(0.5, 0.5)
        Arrow.Rotation = 0
        Arrow.Parent = LocalPlayer.PlayerGui
        ESP_Arrows[Player] = Arrow
    end
end

function RemoveArrow(Player)
    if ESP_Arrows[Player] then
        ESP_Arrows[Player]:Destroy()
        ESP_Arrows[Player] = nil
    end
end

function UpdateESP()
    for _, Player in pairs(Players:GetPlayers()) do
        if Player ~= LocalPlayer and Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
            local RootPart = Player.Character.HumanoidRootPart
            local RootPosition, RootVis = Camera:WorldToViewportPoint(RootPart.Position)

            if RootVis then
                local Arrow = ESP_Arrows[Player]
                if Arrow then
                    local ScreenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
                    local Direction = (Vector2.new(RootPosition.X, RootPosition.Y) - ScreenCenter).unit
                    local Angle = math.deg(math.atan2(Direction.Y, Direction.X))

                    Arrow.Position = UDim2.new(0, ScreenCenter.X, 0, ScreenCenter.Y)
                    Arrow.Rotation = Angle
                    Arrow.Visible = true
                end
            else
                if ESP_Arrows[Player] then
                    ESP_Arrows[Player].Visible = false
                end
            end
        end
    end
end

RunService.RenderStepped:Connect(UpdateESP)

for _, Player in pairs(Players:GetPlayers()) do
    if Player ~= LocalPlayer then
        CreateArrow(Player)
    end
end

Players.PlayerAdded:Connect(function(Player)
    if Player ~= LocalPlayer then
        CreateArrow(Player)
    end
end)

Players.PlayerRemoving:Connect(function(Player)
    RemoveArrow(Player)
end)
